<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stikies Admin Panel</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 0; margin: 0; background: #f4f4f9; }
        
        /* --- LOGIN STYLES --- */
        #login-section {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #2c3e50;
        }
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            text-align: center;
            width: 300px;
        }
        .login-box h2 { margin-top: 0; color: #333; }
        .login-box input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
        }
        .login-box button {
            width: 100%;
            padding: 12px;
            background: #ff6600;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        .login-box button:hover { background: #e65c00; }
        .error-msg { color: red; font-size: 0.9em; display: none; margin-top: 10px; }

        /* --- DASHBOARD STYLES (Hidden by default) --- */
        #dashboard-section { display: none; padding: 20px; }
        h1 { color: #333; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        .table-container { overflow-x: auto; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #ff6600; color: white; }
        tr:hover { background-color: #f1f1f1; }
        .link-btn { background: #333; color: white; padding: 6px 12px; text-decoration: none; border-radius: 4px; font-size: 12px; }
        #loading { font-size: 1.2em; color: #666; margin-top: 20px; }
        
        .logout-btn {
            float: right;
            background: #c0392b;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="login-section">
        <div class="login-box">
            <h2>üîí Admin Login</h2>
            <input type="text" id="admin-user" placeholder="Username">
            <input type="password" id="admin-pass" placeholder="Password">
            <button onclick="checkLogin()">Login</button>
            <p id="login-error" class="error-msg">‚ùå Invalid Credentials</p>
        </div>
    </div>

    <div id="dashboard-section">
        <button class="logout-btn" onclick="logout()">Logout</button>
        <h1>üõí Stikies Orders</h1>
        <p id="loading">Loading data from database...</p>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Customer</th>
                        <th>Contact</th>
                        <th>Address</th>
                        <th>Details</th>
                        <th>Total</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="order-body">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const USER = "Arisudan Pradhan";
        const PASS = "arisudan@007";
        // PASTE YOUR GOOGLE SCRIPT URL BELOW
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzg1ozcNOyH4LpFLrTiUzmbRh-zVdTuZvdLZRNl16vVYTUJqd1SdEUpAr0uDlJgI6fewQ/exec"; 

        // 1. CHECK LOGIN ON LOAD (Keep session active on refresh)
        if (sessionStorage.getItem("stikies_admin_logged_in") === "true") {
            showDashboard();
        }

        // 2. LOGIN FUNCTION
        function checkLogin() {
            const u = document.getElementById("admin-user").value;
            const p = document.getElementById("admin-pass").value;
            const errorMsg = document.getElementById("login-error");

            if (u === USER && p === PASS) {
                sessionStorage.setItem("stikies_admin_logged_in", "true");
                showDashboard();
            } else {
                errorMsg.style.display = "block";
            }
        }

        // 3. LOGOUT FUNCTION
        function logout() {
            sessionStorage.removeItem("stikies_admin_logged_in");
            location.reload(); // Reloads page to show login screen
        }

        // 4. SHOW DASHBOARD & FETCH DATA
        function showDashboard() {
            document.getElementById("login-section").style.display = "none";
            document.getElementById("dashboard-section").style.display = "block";
            fetchOrders(); // Only fetch data AFTER login
        }

        // 5. FETCH DATA FROM GOOGLE SHEETS
        function fetchOrders() {
            fetch(SCRIPT_URL)
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById("order-body");
                    document.getElementById("loading").style.display = "none";

                    // Reverse data to show newest orders at the top
                    data.reverse().forEach(row => {
                        // Assuming Row Format: [0]Date, [1]Name, [2]Phone, [3]Address, [4]Email, [5]Coupon, [6]Items, [7]Total, [8]Link
                        const tr = document.createElement("tr");
                        const date = new Date(row[0]).toLocaleDateString() + " " + new Date(row[0]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                        
                        tr.innerHTML = `
                            <td>${date}</td>
                            <td><strong>${row[1]}</strong><br><small style="color:#666">${row[4] || ''}</small></td>
                            <td>${row[2]}</td>
                            <td style="max-width: 200px;">${row[3]}</td>
                            <td style="font-size:0.9em; color:#555; max-width: 250px;">${row[6]}</td>
                            <td><span style="background:#e8f5e9; color:#2e7d32; padding:4px 8px; border-radius:4px; font-weight:bold;">‚Çπ${row[7]}</span></td>
                            <td><a href="${row[8]}" target="_blank" class="link-btn">View Receipt</a></td>
                        `;
                        tbody.appendChild(tr);
                    });
                })
                .catch(err => {
                    document.getElementById("loading").innerHTML = "<span style='color:red'>Failed to load data. Check console.</span>";
                    console.error(err);
                });
        }
        
        // Allow "Enter" key to submit login
        document.getElementById("admin-pass").addEventListener("keypress", function(event) {
            if (event.key === "Enter") checkLogin();
        });
    </script>
</body>
</html>